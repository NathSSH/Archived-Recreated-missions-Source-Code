-- The Rumble/Fighting Johnny Vincent

MissionSetup = function()

	DATLoad("3_06New.DAT", 2)
	DATInit()
	ToggleHUDComponentVisibility(11, false)
	ToggleHUDComponentVisibility(4, false)
	ToggleHUDComponentVisibility(0, false)
	SoundDisableSpeech_ActionTree()
	ClockSet(18, 30)
	HUDClearAllElements()
	LockFPS30(false)

end

main = function()

	F_PrepsIntroNIS()
	F_GreasersIntroNIS()
	F_MissionSetup()
	F_Stage1Setup()
	
	repeat
	Wait(0)
	until (PlayerIsInAreaObject(Peanut, 2, 20, 0) or PedIsHit(Peanut, 2, 1000) and PedGetWhoHitMeLast(Peanut) == gPlayer)
	F_PeanutRun()
	TextPrintString("Don't let Peanut get away.", 3, 1)
	Wait(500)
	F_StageBeta2Setup()
	
	repeat
	Wait(0)
	until PlayerIsInAreaXYZ(476.35, -455.96,  2.94, 5, 0)

	F_StageBeta3Setup()

	repeat
	Wait(0)
	until PedIsDead(Norton) and PedIsDead(Ricky) and PedIsDead(Lucky) and PedIsDead(Hal) and PedIsDead(Peanut)

    Wait(1000)
    CameraFade(500, 0)
	PlayerSetControl(0)
    Wait(1001)
	F_BetaNISAfter()
	F_GoSaveGord()
	CameraFade(500, 0)
	F_LastRumbleNIS()

	repeat
	Wait(0)
	until PedIsDead(Norton) and PedIsDead(Hal) and PedIsDead(Lucky)

    SoundPlayStream("MS_EpicConfrontationEnding.rsm", MUSIC_DEFAULT_VOLUME)
	SoundFadeWithCamera(true)
    Wait(3500)
	PlayerSetControl(0)
	SoundStopStream()
	CameraFade(500, 0)
	Wait(500)
	DATUnload(2)
	PlayerUnequip()
	if PedIsValid(Gord2) then
		PedDelete(Gord2)
	end
	DeleteAllMissionPeds()
	UnLoadAnimationGroup("NPC_AggroTaunt")
	UnLoadAnimationGroup("NIS_3_04")
	UnLoadAnimationGroup("MINI_React")
	UnLoadAnimationGroup("Boxing")
	PedSetGlobalAttitude_Rumble(false)
	Wait(25)
	DATLoad("3_B.DAT", 2)
	AreaTransitionXYZ(43, -589.22, -608.99, 4.47)
	F_FightingJohnnyVIntro()
	F_BikeChase()

end

F_PrepsIntroNIS = function()

	AreaTransitionXYZ(0, 514.71, -164.09, 4.94)
	PlayerSetControl(0)
	AreaOverridePopulation(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
	VehicleOverrideAmbient(0, 0, 0, 0)
	CreateThread("DeleteFuckers")
	LoadAnimationGroup("Boxing")
	LoadActionTree("Act/Conv/1_08.act")
	LoadAnimationGroup("MINI_React")
	LoadAnimationGroup("NPC_AggroTaunt")
	LoadAnimationGroup("G_Johnny")
	LoadAnimationGroup("NIS_3_04")
	Darby = PedCreateXYZ(37, 495.156006, -154.628006, 4.655510)
	Chad = PedCreateXYZ(32, 497.154999, -150.106995, 4.714850)
	Parker = PedCreateXYZ(40, 496.098999, -150.847000, 4.698040)
	Justin = PedCreateXYZ(34, 495.157990, -150.100006, 4.705140)
	Prep1 = PedCreateXYZ(31, 494.109985, -150.845001, 4.688310)
	Prep2 = PedCreateXYZ(35, 492.864014, -150.102997, 4.696450)
	PedFaceHeading(Chad, 180)
	PedFaceHeading(Parker, 180)
	PedFaceHeading(Justin, 180)
	PedFaceHeading(Prep1, 180)
	PedFaceHeading(Prep2, 180)
	SoundPlayInteractiveStreamLocked("MS_EpicConfrontationHigh.rsm", MUSIC_DEFAULT_VOLUME)
	Wait(2750)
	CameraSetXYZ(499.31, -148.68, 7.37, 496.39, -151.23, 6.40)
	MusicFadeWithCamera(false)
	Wait(20)
	SoundPlayScriptedSpeechEvent(Darby, "M_3_06", 1, "supersize")
	Wait(6700)
	CameraSetXYZ(495.78, -153.58, 5.97, 493.54, -156.86, 6.39)
	SoundPlayScriptedSpeechEvent(Darby, "M_3_06", 2, "supersize")
	Wait(5050)
	CameraSetXYZ(495.14, -153.39, 5.67, 495.04, -157.14, 7.06)
	SoundPlayScriptedSpeechEvent(Darby, "M_3_06", 3, "supersize")
	PedSetActionNode(Darby, "/Global/2_08Conv/ComeOn", "Act/Conv/2_08.act")
	Wait(1900)
	PedSetTaskNode(Chad, "/Global/AI/ScriptedAI/CheeringAINode", "Act/AI/AI.act")
	PedSetTaskNode(Parker, "/Global/AI/ScriptedAI/CheeringAINode", "Act/AI/AI.act")
	PedSetTaskNode(Justin, "/Global/AI/ScriptedAI/CheeringAINode", "Act/AI/AI.act")
	PedSetTaskNode(Prep1, "/Global/AI/ScriptedAI/CheeringAINode", "Act/AI/AI.act")
	PedSetTaskNode(Prep2, "/Global/AI/ScriptedAI/CheeringAINode", "Act/AI/AI.act")
	Wait(200)
	CameraSetXYZ(496.61, -156.30, 6.37, 495.40, -152.49, 6.18)
	SoundPlayScriptedSpeechEvent(Chad, "M_3_06", 4, "supersize")
	SoundPlayScriptedSpeechEvent(Parker, "M_3_06", 5, "supersize")
	SoundPlayScriptedSpeechEvent(Justin, "M_3_06", 6, "supersize")
	Wait(2800)
	CameraFade(500, 0)
	Wait(501)
	LoadActionTree("Act/Conv/3_06.act")
	PedStop(Chad)
	PedStop(Parker)
	PedStop(Justin)
	PedStop(Prep1)
	PedStop(Prep2)

end

F_GreasersIntroNIS = function()

		Wait(500)
		PoliceCar = VehicleCreateXYZ(271, 542.62, -313.52, 2.05)
		VehicleFaceHeading(PoliceCar, -45)
		PoliceBike = VehicleCreateXYZ(251, 546.17, -313.50, 2.05)
		VehicleFaceHeading(PoliceBike, 25)
		Cop1 = PedCreateXYZ(238, 544.62, -313.52, 2.05)
		Cop2 = PedCreateXYZ(83, 541.44, -312.22, 4.26)
		Wait(5)
		PedFaceXYZ(Cop2, 542.62, -313.52, 2.05)
		PedWarpIntoCar(Cop1, PoliceCar)
		VehicleEnableSiren(PoliceCar, true)
		VehicleEnableEngine(PoliceCar, true)
		CameraSetXYZ(507.69, -283.38, 4.34, 506.80, -279.53, 3.77)
		AreaTransitionXYZ(0, 491.26, -281.79, 2.63)
		Greaser1 = PedCreateXYZ(22, 507.235992, -278.450989, 2.059530)
		Greaser2 = PedCreateXYZ(24, 503.833008, -276.700989, 2.059350)
		Greaser3 = PedCreateXYZ(26, 508.197998, -277.316010, 2.059500)
		Norton = PedCreateXYZ(29, 509.063995, -275.906006, 2.059260)
		Peanut = PedCreateXYZ(21, 505.65, -279.68, 2.04)
		Vance = PedCreateXYZ(27, 506.65, -279.68, 2.04)
		Wait(5)
		CameraFade(500, 1)
		Wait(1400)
		SoundPlayScriptedSpeechEvent(Peanut, "M_3_06", 7, "supersize")
		CameraSetXYZ(505.46, -277.89, 3.51, 506.50, -281.75, 3.45)
		Wait(2500)
		SoundPlayScriptedSpeechEvent(Vance, "M_3_06", 8, "supersize")
		CameraSetXYZ(505.17, -285.66, 4.01, 506.82, -282.02, 3.39)
		Wait(1150)
		PedMoveToXYZ(Vance, 1, 510.90, -287.89, 2.17)
		Wait(450)
		PedMoveToXYZ(Peanut, 1, 511.90, -287.89, 2.17)
		Wait(900)
		CameraSetXYZ(538.13, -294.21, 3.45, 538.59, -298.18, 3.18)
		PedStop(Peanut)
		PedStop(Vance)
		PedSetPosXYZ(Peanut, 534.20, -293.54, 2.05)
		PedSetPosXYZ(Vance, 532.20, -293.54, 2.05)
		PedMoveToXYZ(Peanut, 1, 537.86, -296.71, 2.25)
		PedMoveToXYZ(Vance, 1, 537.46, -296.99, 2.25)
		Wait(1500)
		SoundPlayScriptedSpeechEvent(Vance, "M_3_06", 9, "supersize")
		Wait(2400)
		SoundPlayScriptedSpeechEvent(Peanut, "M_3_06", 10, "supersize")
		Wait(1800)
		PedMoveToXYZ(Peanut, 1, 522.68, -295.24, 2.06)
		PedMoveToXYZ(Vance, 1, 522.68, -295.24, 2.06)
		Wait(1000)
		CameraFade(500, 0)
		PedStop(Peanut)
		PedStop(Vance)
		Wait(501)
		CameraSetXYZ(486.80, -294.97, 3.24, 490.49, -293.45, 3.43)
		PedSetPosXYZ(Peanut, 494.44, -292.75, 2.41)
		PedSetPosXYZ(Vance, 493.14, -291.85, 2.41)
		PedSetPosXYZ(Greaser3, 496.28, -294.91, 2.35)
		PedSetPosXYZ(Greaser2, 496.28, -294.91, 2.35)
		Wait(90)
		PedMoveToXYZ(Greaser3, 1, 478.51, -292.59, 2.68)
		PedMoveToXYZ(Greaser2, 1, 476.51, -292.59, 2.68)
		Wait(550)
		PedMoveToXYZ(Peanut, 1, 477.75, -294.85, 6.44)
		Wait(90)
		PedMoveToXYZ(Vance, 1, 477.52, -292.99, 2.68)
		CameraFade(500, 1)
		AreaClearAllPeds()
		
		repeat
		Wait(0)
		until not PedIsOnScreen(Peanut) and not PedIsOnScreen(Vance) and not PedIsOnScreen(Greaser2) and not PedIsOnScreen(Greaser3)
		
		Wait(500)
		CameraSetXYZ(482.01, -283.02, 4.04, 483.40, -279.30, 3.58)
		PedSetPosXYZ(Chad, 489.74, -271.64, 2.70)
		Wait(5)
		PedMoveToXYZ(Chad, 2, 483.31, -279.72, 2.70)
		Wait(2000)
		PedSetActionNode(Chad, "/Global/1_08/CafeteriaLady/Point/Point", "Act/Conv/1_08.act")
		SoundPlayScriptedSpeechEvent(Chad, "M_3_06", 11, "supersize")
		CameraSetXYZ(481.81, -281.78, 3.62, 484.03, -278.76, 5.01)
		PedSetPosXYZ(Parker, 489.74, -271.64, 2.70)
		Wait(5)
		PedMoveToXYZ(Parker, 1, 482.01, -279.72, 2.70)
		Wait(1650)
		PedSetFlag(Vance, 11, true)
		PedSetFlag(Greaser2, 11, true)
		PedSetFlag(Greaser3, 11, true)
		PedIgnoreStimuli(Greaser2, true)
		PedIgnoreStimuli(Greaser3, true)
		PedFaceXYZ(Peanut, 483.31, -279.72, 2.70)
		PedFaceXYZ(Vance, 483.31, -279.72, 2.70)
		PedFaceXYZ(Greaser2, 483.31, -279.72, 2.70)
		PedFaceXYZ(Greaser3, 483.31, -279.72, 2.70)
		Wait(50)
		CameraSetXYZ(477.71, -289.92, 3.84, 477.96, -293.90, 3.55)
		SoundPlayScriptedSpeechEvent(Vance, "M_3_06", 12, "supersize")
		Wait(2800)
		PedSetFlag(Chad, 11, true)
		PedSetFlag(Parker, 11, true)
		CameraFade(500, 0)
		PedAttack(Vance, Parker, 2)
		PedAttack(Greaser2, Parker, 2)
		PedAttack(Greaser3, Chad, 2)
		PedAttack(Chad, Greaser3, 2)
		PedAttack(Parker, Greaser2, 2)
		PedMoveToXYZ(Peanut, 2, 480.06, -306.03, 2.70)
		Wait(501)
		PedStop(Peanut)
		AreaTransitionXYZ(0, 496.94, -314.94, 2.31)
		PoliceCar2 = VehicleCreateXYZ(271, 496.63, -331.38, 2.82)
		Cop4 = PedCreateXYZ(83, 496.69, -333.48, 2.82)
		Wait(5)
		PedFaceXYZ(Cop4, 494.88, -322.31, 2.97)
		VehicleEnableSiren(PoliceCar2, true)
		VehicleEnableEngine(PoliceCar2, true)
		Ricky = PedCreateXYZ(28, 494.88, -322.31, 2.97)
		PedSetPosXYZ(Norton, 496.10, -322.51, 2.97)
		PedSetPosXYZ(Peanut, 492.76, -322.08, 2.83)
		Wait(25)
		PedIgnoreStimuli(Ricky, true)
		PedIgnoreStimuli(Norton, true)
		Wait(25)
		PedFaceXYZ(Ricky, 496.69, -333.48, 2.82)
		PedFaceXYZ(Norton, 496.69, -333.48, 2.82)
		PedSetFlag(Ricky, 11, true)
		PedSetFlag(Norton, 11, true)
		CameraSetXYZ(493.41, -335.95, 5.20, 495.57, -332.74, 4.21)
		Wait(600)
		CameraFade(500, 1)
		Wait(1500)
		CameraSetXYZ(494.09, -323.44, 4.11, 496.81, -320.51, 4.11)
		SoundPlayScriptedSpeechEvent(Ricky, "M_3_06", 13, "supersize")
		Wait(2400)
		CameraSetXYZ(496.89, -323.70, 4.11, 494.01, -320.95, 3.81)
		SoundPlayScriptedSpeechEvent(Norton, "M_3_06", 14, "supersize")
		Wait(1800)
		CameraSetXYZ(492.56, -323.84, 4.21, 493.54, -319.96, 4.22)
		SoundPlayScriptedSpeechEvent(Peanut, "M_3_06", 15, "supersize")
		Wait(1900)
		CameraFade(500, 0)
		Wait(501)
		PedSetPosXYZ(Norton, 498.13, -329.91, 2.81)
		PedSetPosXYZ(Cop4, 498.10, -328.31, 2.81)
		Wait(5)
		PedLockTarget(Cop4, Norton, 3)
		PedFaceObject(Cop4, Norton, 3, 1)
		PedIgnoreStimuli(Cop4, true)
		Wait(25)
		PedIgnoreStimuli(Greaser2, false)
		PedIgnoreStimuli(Greaser3, false)
		PedIgnoreStimuli(Ricky, false)
		PedSetActionNode(Cop4, "/Global/3_06/Frisk/GrappleAttempt", "Act/Conv/3_06.act")
PedsCanNowAppear = true
		PedDelete(Peanut)
		PedDelete(Ricky)
		PedDelete(Greaser1)
		PedDelete(Darby)
		PedDelete(Prep1)
		PedDelete(Prep2)
		PedDelete(Justin)

end

DeleteFuckers = function()

		repeat
		AreaClearAllPeds()
		AreaClearPatrolPaths()
		AreaClearSpawners()
		AreaClearAllVehicles()
		Wait(0)
		until PedsCanNowAppear

end

F_MissionSetup = function()

  SetPopulationFastCulling(true)
  POIGroupsEnabled(false)
  PedSetUniqueModelStatus(25, -1)
  PedSetUniqueModelStatus(38, -1)
  PedSetUniqueModelStatus(21, -1)
  PedSetUniqueModelStatus(23, -1)
  AreaOverridePopulation(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  VehicleOverrideAmbient(0, 0, 0, 0)
  l_0_6 = PedGetTypeToTypeAttitude(4, 24)
  l_0_7 = PedGetTypeToTypeAttitude(4, 2)
  l_0_8 = PedGetTypeToTypeAttitude(2, 4)
  l_0_9 = PedGetTypeToTypeAttitude(5, 4)
  PedSetTypeToTypeAttitude(4, 5, 27)
  PedSetTypeToTypeAttitude(4, 2, 0)
  PedSetTypeToTypeAttitude(2, 4, 0)
  PedSetTypeToTypeAttitude(2, 13, 3)
  PedSetTypeToTypeAttitude(5, 4, 0)
  PedSetTypeToTypeAttitude(5, 13, 3)
  LoadAnimationGroup("Cop_Frisk")
  LoadAnimationGroup("NPC_AggroTaunt")
  LoadAnimationGroup("IDLE_GREAS_C")
  LoadAnimationGroup("NIS_3_06")
  LoadActionTree("Act/Conv/3_06.act")
  AreaTransitionPoint(0, POINTLIST._STARTINGPOINT, 1)
  PedSetFlag(gPlayer, 75, true)
  PedSetGlobalAttitude_Rumble(true)
  local l_2_0, l_2_1 = CreatePersistentEntity("3_06BinBarr02", 525.40399169922, -355.87298583984, 29, 28, 27)
  JimBike = VehicleCreateXYZ(249, 503.90, -253.46, 2.07)
  VehicleFaceHeading(JimBike, -180)

end

F_Stage1Setup = function()
  AreaSetTriggerMonitoringRules(TRIGGER._AMBIENTEVENT1, true)
  AreaSetTriggerMonitoringRules(TRIGGER._AMBIENTEVENT2, true)
  CameraReset()
  CameraReturnToPlayer()
  Wait(100)
  AreaOverridePopulation(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  VehicleOverrideAmbient(0, 0, 0, 0)
  local l_10_0 = PedCreatePoint(31, POINTLIST._INITIALPREPS, 1)
  local l_10_1 = PedCreatePoint(32, POINTLIST._INITIALPREPS, 2)
  local l_10_2 = PedCreatePoint(26, POINTLIST._INTRONIS, 7)
  local l_10_3 = PedCreatePoint(24, POINTLIST._INTRONIS, 8)
  l_0_10 = PedCreatePoint(28, POINTLIST._INTRONIS, 10)
  PedAttack(l_10_0, l_10_2, 1)
  PedAttack(l_10_2, l_10_0, 1)
  PedAttack(l_10_1, l_10_3, 1)
  PedAttack(l_10_3, l_10_1, 1)
  PedAttack(l_0_10, l_10_1, 1)
  PedSetInvulnerable(l_0_10, true)
  Wait(1000)
  CameraFade(500, 1)
  PlayerSetControl(1)
  Wait(501)
  TextPrintString("Look around for Peanut.", 3, 1)
  PedMakeAmbient(l_10_0)
  PedMakeAmbient(l_10_1)
  PedMakeAmbient(l_10_2)
  PedMakeAmbient(l_10_3)
  Peanut = PedCreatePoint(21, POINTLIST._3_06_GREASERS, 4)
  PedMakeTargetable(Peanut, false)
  PedSetInvulnerable(Peanut, true)
  l_0_12 = VehicleCreatePoint(248, POINTLIST._3_06_PEANUTBIKE)
  Wait(5)
  VehicleFaceHeading(l_0_12, 180)
  Wait(5)
  PedPutOnBike(Peanut, l_0_12)
  Wait(10)
  Wait(1000)
  AreaOverridePopulation(4, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0)

end

F_PeanutRun = function()

	PedIgnoreStimuli(Peanut, true)
	PedStop(Peanut)
	PedLockTarget(Peanut, -1)
	PedMoveToPoint(Peanut, 2, POINTLIST._FINALFIGHT, 5)
	Wait(1000)
	SoundPlayScriptedSpeechEvent(Peanut, "M_3_06", 16, "supersize")
	Wait(2200)
	SoundPlayScriptedSpeechEvent(Peanut, "M_3_06", 17, "supersize")
	PedDelete(Greaser1)
	PedDelete(Vance)
	PedDelete(Cop4)
	
end

F_StageBeta2Setup = function()

	Norton = PedCreateXYZ(29, 477.12, -462.19, 3.47)
	Ricky = PedCreateXYZ(28, 476.12, -462.00, 3.47)
	Lucky = PedCreateXYZ(26, 475.12, -461.89, 3.47)
	Hal = PedCreateXYZ(22, 474.12, -460.19, 3.47)
	PedSetStationary(Norton, true)
	PedSetStationary(Ricky, true)
	PedSetStationary(Lucky, true)
	PedSetStationary(Hal, true)
	PedSetAsleep(Norton, true)
	PedSetAsleep(Ricky, true)
	PedSetAsleep(Lucky, true)
	PedSetAsleep(Hal, true)

end

F_StageBeta3Setup = function()

	PedMakeTargetable(Peanut, true)
	PedSetInvulnerable(Peanut, false)
	AreaOverridePopulation(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
	PedExitVehicle(Peanut)
	PlayerSetControl(0)
	CameraFade(500, 0)
	Wait(501)
	F_BetaNIS()
	PedMakeTargetable(Peanut, true)
	PedAttack(Norton, gPlayer, 1)
	PedAttack(Ricky, gPlayer, 1)
	PedAttack(Lucky, gPlayer, 1)
	PedAttack(Hal, gPlayer, 1)
	PedAttack(Peanut, gPlayer, 1)
	PedSetInvulnerable(Peanut, false)
	PedSetHealth(Peanut, 200)
	--PedSetActionNode(l_0_4[1], "/Global/3_06/CreateAuthFight", "Act/Conv/3_06.act")

end

F_BetaNIS = function()

		CameraFade(500, 0)
		PlayerSetControl(0)
		Wait(1500)
		SoundStopInteractiveStream(0)
		Wait(5)
		SoundPlayStream("MS_EpicConfrantation_NIS.rsm", MUSIC_DEFAULT_VOLUME)
		VehicleDelete(l_0_12)
		PedSetTypeToTypeAttitude(4, 13, 4)
		PedSetFlag(gPlayer, 108, true)
		PedSetFlag(gPlayer, 117, false)
		StopAmbientPedAttacks()
		SetAmbientPedsIgnoreStimuli(true)
		PedStop(gPlayer)
		PedSetInvulnerable(gPlayer, true)
		AreaClearAllVehicles()
		SoundFadeWithCamera(false)
		if PedIsValid(Peanut) then
			PedDelete(Peanut)
		end
		PlayerDetachFromVehicle()
		VehicleSetPosXYZ(JimBike, 475.36, -455.04, 2.91)
		PlayerSetPosXYZ(476.27, -455.16, 2.91)
		Peanut = PedCreateXYZ(21, 474.86, -460.62, 3.28)
		PedMakeTargetable(gPlayer, false)
		PedSetAsleep(Peanut, true)
		Wait(5)
		PedFaceObject(Peanut, gPlayer, 3, 0)
		PedLockTarget(Peanut, gPlayer)
		PedSetPosXYZ(Norton, 475.48, -462.88, 3.74)
		PedSetPosXYZ(Ricky, 474.48, -462.78, 3.74)
		PedSetPosXYZ(Lucky, 473.48, -462.69, 3.74)
		PedSetPosXYZ(Hal, 472.68, -462.62, 3.74)
		CameraSetXYZ(478.26, -456.19, 4.46, 475.05, -458.58, 4.37)
		Wait(5)
		PedFaceObject(Norton, gPlayer, 3, 0)
		PedLockTarget(Norton, gPlayer)
		PedFaceObject(Ricky, gPlayer, 3, 0)
		PedLockTarget(Ricky, gPlayer)
		PedFaceObject(Lucky, gPlayer, 3, 0)
		PedLockTarget(Lucky, gPlayer)
		PedFaceObject(Hal, gPlayer, 3, 0)
		PedLockTarget(Hal, gPlayer)
		CameraFade(500, 1)
		PedMoveToXYZ(gPlayer, 0, 475.81, -457.42, 2.96)
		Wait(1250)
		CameraSetXYZ(474.73, -458.60, 4.66, 474.57, -462.59, 4.92)
		SoundPlayScriptedSpeechEvent(Peanut, "M_3_06", 22, "supersize")
		Wait(2400)
		CameraSetXYZ(474.57, -458.24, 4.45, 477.74, -455.80, 4.39)
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_06", 25, "supersize")
		Wait(2400)
		CameraSetXYZ(475.09, -461.43, 5.16, 476.30, -465.24, 5.25)
		SoundPlayScriptedSpeechEvent(Norton, "M_3_06", 23, "supersize")
		Wait(2800)
		CameraSetXYZ(474.18, -461.31, 5.16, 474.89, -465.24, 5.22)
		SoundPlayScriptedSpeechEvent(Ricky, "M_3_06", 19, "supersize")
		Wait(1600)
		CameraSetXYZ(473.51, -461.29, 5.16, 473.37, -465.29, 5.22)
		SoundPlayScriptedSpeechEvent(Lucky, "M_3_06", 20, "supersize")
		Wait(1800)
		CameraSetXYZ(472.83, -461.08, 5.16, 472.52, -465.07, 5.22)
		SoundPlayScriptedSpeechEvent(Hal, "M_3_06", 21, "supersize")
		Wait(1600)
		CameraFade(500, 0)
		Wait(501)
		AreaOverridePopulation(8, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0)
		CameraReturnToPlayer()
		SoundPlayInteractiveStreamLocked("MS_EpicConfrontationHigh.rsm", MUSIC_DEFAULT_VOLUME)
		CameraFade(500, 1)
		PlayerSetControl(1)
		PedSetInvulnerable(gPlayer, false)
		SetAmbientPedsIgnoreStimuli(false)
		PedMakeTargetable(gPlayer, true)
		PedSetFlag(gPlayer, 108, false)
		PedSetTypeToTypeAttitude(4, 13, 0)
		PedSetFlag(gPlayer, 117, true)
		PedSetStationary(Norton, false)
		PedSetStationary(Ricky, false)
		PedSetStationary(Lucky, false)
		PedSetStationary(Hal, false)
		PedSetAsleep(Norton, false)
		PedSetAsleep(Ricky, false)
		PedSetAsleep(Lucky, false)
		PedSetAsleep(Hal, false)
		Wait(450)
		TextPrintString("Defeat the greasers.", 3, 1)

end

F_BetaNISAfter = function()

		PedsCanNowAppear = false
		CreateThread("DeleteFuckers")
		AreaClearAllPeds()
		if PedIsValid(Peanut) then
			PedDelete(Peanut)
		end
		AreaClearAllExplosions()
		AreaClearAllPeds()
		AreaClearAllProjectiles()
		AreaClearAllVehicles()
		AreaClearDockers()
		AreaClearPatrolPaths()
		AreaClearSpawners()
		DeleteAllMissionPeds()
		AreaOverridePopulation(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
		Wait(50)
		Peanut2 = PedCreateXYZ(21, 475.89, -458.49, 2.96)
		Wait(50)
		PedSetPedToTypeAttitude(Peanut2, 13, 4)
		Wait(300)
		PedFaceObject(Peanut2, gPlayer, 3, 0)
		Wait(10)
		PedFaceXYZ(Peanut2, 475.89, -457.29, 2.96)
		Wait(10)
		PedSetPosXYZ(gPlayer, 475.89, -457.29, 2.96)
		Wait(10)
		PedFaceObject(gPlayer, Peanut2, 3, 0)
		Wait(10)
		PedFaceXYZ(gPlayer, 475.89, -458.49, 2.96)
		CameraSetXYZ(477.56, -456.97, 4.46, 474.09, -458.94, 4.20)
		Wait(500)
		CameraFade(500, 1)
		Wait(500)
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_06", 26, "supersize")
		Wait(1400)
		SoundPlayScriptedSpeechEvent(Peanut2, "M_3_06", 25, "supersize")
		Wait(4000)
		CameraSetXYZ(474.30, -458.72, 4.56, 477.70, -456.73, 3.87)
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_06", 28, "supersize")
		Wait(1500)
		PlayerSetControl(1)
		CameraReturnToPlayer()
PedsCanNowAppear = true
		AreaClearAllPeds()
		PedSetTypeToTypeAttitude(4, 13, 0)
		PedWander(Peanut2)

end

F_GoSaveGord = function()

		Greaser1 = PedCreateXYZ(24, 503.471008, -437.071991, 4.299300)
		Greaser2 = PedCreateXYZ(28, 502.209015, -435.735992, 4.314500)
		Gord = PedCreateXYZ(30, 501.485010, -437.154010, 4.334400)
		Wait(5)
		PedSetHealth(Gord, 200)
		PedRecruitAlly(gPlayer, Gord)
		PedSetStationary(Gord, true)
		PedSetPedToTypeAttitude(Gord, 4, 1)
		GameSetPedStat(Gord, 7, 200)
		Wait(25)
		SoundPlayScriptedSpeechEvent(Gord, "M_3_06", 29, "supersize")
		TextPrintString("Go help Gord.", 3, 1)
		Wait(2000)
		SoundPlayScriptedSpeechEvent(Gord, "M_3_06", 29, "supersize")
		PedAttack(Greaser1, Gord, 1)
		PedAttack(Greaser2, Gord, 1)
		PedMakeTargetable(Gord, false)

		repeat
		Wait(0)
		until PlayerIsInAreaXYZ(496.50, -430.27, 2.75, 3, 0)
		
		GameSetPedStat(Gord, 7, 0)
		PedSetPedToTypeAttitude(Gord, 4, 0)
		PedSetPedToTypeAttitude(Gord, 13, 3)
		PedAttack(Gord, Greaser1, 2)
		PedSetStationary(Gord, false)

		repeat
		Wait(0)
		until PedIsDead(Greaser1) and PedIsDead(Greaser2)

		SoundFadeWithCamera(true)
		MusicFadeWithCamera(true)
		PedStop(Gord)
		PedClearObjectives(Gord)
		PedSetStationary(Gord, true)
		PlayerSetControl(0)
		Wait(250)
		CameraFade(500, 0)
		Wait(1001)
		PedDelete(Greaser1)
		PedDelete(Greaser2)
		Wait(500)
		AreaClearAllPeds()
		PedHideHealthBar()
		PedHideHealthBar()
		PedHideHealthBar()
		Wait(500)
		PlayerSetPosXYZ(505.86, -436.09, 4.09)
		Gord2 = PedCreateXYZ(30, 505.30, -435.35, 4.09)
		PedRecruitAlly(gPlayer, Gord2)
		GameSetPedStat(Gord2, 7, 200)
		Wait(50)
		PedFaceObject(gPlayer, Gord2, 3, 1)
		PedFaceObject(Gord2, gPlayer, 3, 1)
		Wait(50)
		CameraFade(500, 1)
		CameraSetXYZ(502.98, -430.84, 5.59, 505.76, -433.69, 5.21)
		SoundPlayScriptedSpeechEvent(Gord2, "M_3_06", 30, "supersize")
		Wait(1600)
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_06", 31, "supersize")
		Wait(2200)
		SoundPlayScriptedSpeechEvent(Gord2, "M_3_06", 32, "supersize")
		Wait(2500)

end

F_LastRumbleNIS = function()

  AreaClearAllVehicles()
  AreaClearAllPeds()
  SoundFadeWithCamera(false)
  SoundStopStream()
  SoundStopInteractiveStream()
  SoundPlayStream("MS_EpicConfrantation_NIS.rsm", MUSIC_DEFAULT_VOLUME)
  PedMakeTargetable(gPlayer, false)
  Wait(701)
  AreaClearAllPeds()
  PedHideHealthBar()
	AreaTransitionXYZ(0, 539.96, -481.47, 4.65)
	Wait(50)
	PedFaceXYZ(gPlayer, 544.71, -464.02, 4.42)
	Johnny = PedCreateXYZ(23, 544.71, -464.02, 4.42)
	PedFaceXYZ(Johnny, 543.33, -465.37, 4.42)
	Hal = PedCreateXYZ(22, 543.33, -465.37, 4.42)
	Norton = PedCreateXYZ(29, 544.32, -466.24, 4.42)
	Lucky = PedCreateXYZ(26, 545.45, -465.88, 4.42)
	Wait(5)
	PedSetActionNode(Johnny, "/Global/3_04/3_04_Anim/JohnnyIdle/JohnnyIdle", "Act/Conv/3_04.act")
	PedSetPedToTypeAttitude(Johnny, 13, 3)
	PedSetStationary(Johnny, true)
	PedSetAsleep(Johnny, true)
	PedFaceXYZ(Hal, 544.71, -464.02, 4.42)
	PedFaceXYZ(Norton, 544.71, -464.02, 4.42)
	PedFaceXYZ(Lucky, 544.71, -464.02, 4.42)
	Wait(500)
	CameraSetXYZ(547.24, -464.39, 5.96, 543.34, -465.12, 5.47)
	CameraFade(500, 1)
	Wait(400)
	SoundPlayScriptedSpeechEvent(Hal, "M_3_06", 33, "supersize")
	Wait(2500)
	CameraSetXYZ(541.84, -464.04, 6.11, 545.58, -465.28, 5.44)
	SoundPlayScriptedSpeechEvent(Johnny, "M_3_06", 34, "supersize")
	Wait(5100)
	CameraSetXYZ(547.24, -464.39, 5.96, 543.34, -465.12, 5.47)
	SoundPlayScriptedSpeechEvent(Hal, "M_3_06", 35, "supersize")
	Wait(1200)
	CameraSetXYZ(542.65, -475.08, 5.25, 539.95, -478.01, 5.58)
	PedMoveToXYZ(gPlayer, 1, 540.95, -478.04, 4.65)
	SoundPlayScriptedSpeechEvent(gPlayer, "M_3_06", 36, "supersize")
	Wait(2400)
	PedSetFlag(gPlayer, 11, true)
	PedSetFlag(Gord2, 11, true)
	CameraSetXYZ(541.95, -475.99, 5.75, 539.18, -478.86, 5.97)
	PedFaceXYZ(Johnny, 541.07, -476.98, 4.51)
	PedFaceXYZ(Hal, 541.07, -476.98, 4.51)
	PedFaceXYZ(Norton, 541.07, -476.98, 4.51)
	PedFaceXYZ(Lucky, 541.07, -476.98, 4.51)
	SoundPlayScriptedSpeechEvent(gPlayer, "M_3_06", 37, "supersize")
	Wait(4300)
	CameraSetXYZ(542.41, -466.92, 5.94, 544.99, -463.91, 5.52)
	SoundPlayScriptedSpeechEvent(Hal, "M_3_06", 38, "supersize")
	PedSetActionNode(Hal, "/Global/1_08/CafeteriaLady/Point/Point", "Act/Conv/1_08.act")
	SoundStopStream()
	SoundPlayInteractiveStreamLocked("MS_EpicConfrontationHighPart2.rsm", MUSIC_DEFAULT_VOLUME)
	Wait(600)
	PedAddPedToIgnoreList(Johnny, gPlayer)
	PedAddPedToIgnoreList(Johnny, Gord2)
	PedSetFlag(gPlayer, 11, false)
	PedSetFlag(Gord2, 11, false)
	Wait(500)
	PlayerSetControl(1)
	CameraReturnToPlayer()
	PedStop(Johnny)
	PedDelete(Johnny)
	PedAttack(Hal, gPlayer, 2)
	PedAttack(Norton, Gord2, 2)
	PedAttack(Lucky, gPlayer, 2)
	CameraFade(500, 1)
	Wait(450)
	TextPrintString("Defeat the greasers.", 3, 1)

end

F_FightingJohnnyVIntro = function()

		Wait(100)
		PedFaceXYZ(gPlayer, -589.22, -607.99, 4.47)
		SoundPlayStream("MS_3B_JohhnyV_NIS.rsm", MUSIC_DEFAULT_VOLUME)
		Hal1 = PedCreateXYZ(22, -589.99, -606.16, 4.46)
		Norton1 = PedCreateXYZ(29, -588.38, -605.25, 4.46)
		Lucky1 = PedCreateXYZ(26, -586.78, -606.47, 4.46)
		Johnny1 = PedCreateXYZ(23, -587.57, -602.31, 4.44)
		Peanut1 = PedCreateXYZ(21, -595.13, -608.08, 4.51)
		Vance1 = PedCreateXYZ(27, -596.59, -608.03, 4.51)
		Ricky1 = PedCreateXYZ(28, -582.70, -611.90, 4.52)
		Wait(5)
		PedSetFlag(gPlayer, 11, true)
		PedSetFlag(Hal1, 11, true)
		PedSetFlag(Norton1, 11, true)
		PedSetFlag(Lucky1, 11, true)
		PedFaceXYZ(Hal1, -589.22, -608.99, 4.47)
		PedFaceXYZ(Norton1, -589.22, -608.99, 4.47)
		PedFaceXYZ(Johnny1, -589.22, -608.99, 4.47)
		PedFaceXYZ(gPlayer, -587.57, -602.31, 4.44)
		PedFaceXYZ(Lucky1, -589.22, -608.99, 4.47)
		PedFaceXYZ(Ricky1, -595.13, -608.08, 4.51)
		CameraSetXYZ(-588.90, -596.94, 8.10, -588.08, -600.01, 6.41)
		Wait(2900)
		Cop1 = PedCreateXYZ(238, -602.69, -609.26, 4.37)
		Car1 = VehicleCreateXYZ(271, -610.76, -607.85, 4.34)
		Wait(5)
		Cop3 = PedCreateXYZ(83, -580.32, -575.80, 5.00)
		Car3 = VehicleCreateXYZ(271, -582.12, -581.77, 5.00)
		Wait(10)
		PedWarpIntoCar(Cop1, Car1)
		PedWarpIntoCar(Cop3, Car3)
		VehicleEnableSiren(Car1, true)
		VehicleEnableEngine(Car1, true)
		VehicleEnableSiren(Car3, true)
		VehicleEnableEngine(Car3, true)
		Wait(100)
		CameraSetXYZ(-606.57, -612.48, 7.02, -603.23, -611.43, 6.24)
		VehicleFaceHeading(Car3, 170)
		Wait(5)
		PedSetFlag(gPlayer, 11, false)
		PedSetFlag(Hal1, 11, false)
		PedSetFlag(Norton1, 11, false)
		PedSetFlag(Lucky1, 11, false)
		VehicleMoveToXYZ(Car1, -593.69, -613.13, 4.50)
		PedMoveToXYZ(Peanut1, 3, -585.00, -640.61, 4.50)
		SoundPlayScriptedSpeechEvent(Peanut1, "M_3_B", 1, "supersize")
		PedMoveToXYZ(Vance1, 3, -585.00, -640.61, 4.50)
		Wait(2500)
		CameraSetXYZ(-585.79, -584.93, 8.29, -585.42, -588.54, 6.61)
		VehicleMoveToXYZ(Car3, -586.44, -597.04, 4.43)
		Wait(3000)
		CameraSetXYZ(-586.07, -619.98, 6.97, -587.98, -616.18, 6.27)
		PedMoveToXYZ(Ricky1, 3, -589.72, -628.34, 4.43)
		PedMoveToXYZ(Hal1, 3, -585.00, -640.61, 4.50)
		SoundPlayScriptedSpeechEvent_2D("M_3_B_2D", 3, "supersize")
		PedMoveToXYZ(Norton1, 3, -585.00, -640.61, 4.50)
		PedMoveToXYZ(Lucky1, 3, -585.00, -640.61, 4.50)
		Wait(3400)
		PedDelete(Hal1)
		PedDelete(Norton1)
		PedDelete(Lucky1)
		PedDelete(Ricky1)
		PedDelete(Vance1)
		PedDelete(Peanut1)
		AreaClearAllVehicles()
		Wait(100)
		CameraSetXYZ(-588.24, -600.73, 6.16, -588.25, -604.67, 5.54)
		Wait(50)
		SoundPlayScriptedSpeechEvent(Johnny1, "M_3_B", 5, "supersize")
		Wait(3300)
		CameraSetXYZ(-590.41, -609.73, 6.00, -588.53, -606.22, 5.70)
		Wait(50)
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_B", 6, "supersize")
		Wait(2600)
		CameraFade(500, 0)
		Wait(500)
		PlayerSetPosXYZ(-584.806030, -633.229980, 4.631830)
		PedDelete(Johnny1)
		PedDelete(Cop1)
		PedDelete(Cop3)
		VehicleDelete(Car1)
		VehicleDelete(Car3)
end

F_BikeChase = function()

		JimmyBike = VehicleCreatePoint(249, POINTLIST._PLAYERBIKEFIRSTSTART)
		Wait(100)
		PlayerPutOnBike(JimmyBike)
		FollowCamSetVehicleShot("JunkyardChase")
		CopCar = VehicleCreatePoint(271, POINTLIST._3_B_COPCAR_WARP)
		JohnnyBike = VehicleCreateXYZ(258, -565.09, -651.33, 1.41)
		JohnnyChase = PedCreateXYZ(23, -564.22, -650.07, 1.51)
		Wait(5)
		PedPutOnBike(JohnnyChase, JohnnyBike)
		CopCarDriver = PedCreatePoint(97, POINTLIST._3B_COPSPAWN)
		PedIgnoreStimuli(CopCarDriver, true)
		PedIgnoreAttacks(CopCarDriver, true)
		PedSetCheap(CopCarDriver, true)
		PedWarpIntoCar(CopCarDriver, CopCar)
		VehicleEnableSiren(CopCar, true)
		Wait(100)
		CameraFade(500, 1)
		Wait(500)
		PlayerSetControl(1)
		IntoCutscene = false
		PedSetPunishmentPoints(gPlayer, 800)
		PedIgnoreStimuli(JohnnyChase, true)
		PedFollowPath(JohnnyChase, PATH._3_B_JOHNNYBIKECHASEPLAYER, 0, 1)
		CreateThread("MonitorJohnnySpeed")
		SoundStopStream()
		SoundPlayStream("MS_FightingJohnnyVincentBikeRide.rsm", 0.80000001192093, 0, 500)
		Wait(1000)
		VehicleFollowPath(CopCar, PATH._3_B_COPCARCHASEPLAYER, true)
		VehicleSetCruiseSpeed(CopCar, 8)
		VehicleSetDrivingMode(CopCar, 3)
		CreateThread("T1_CopChaseCarCam")
		CreateThread("MonitorChaseAsAWhole")
		MusicAllowPlayDuringCutscenes(true)

end

MonitorChaseAsAWhole = function()

		repeat
		Wait(0)
		until PlayerIsInAreaXYZ(-582.44, -727.43, 0.94, 8, 0)
		Lefty3 = PedCreateXYZ(24, -616.00, -753.75, 1.06)
		Norton2 = PedCreateXYZ(29, -617.38, -753.77, 1.19)
		Ricky2 = PedCreateXYZ(28, -620.10, -753.68, 1.23)
		Peanut2 = PedCreateXYZ(21, -622.26, -750.21, 1.31)
		Wait(5)
		PedIgnoreStimuli(Lefty3)
		PedIgnoreStimuli(Norton2)
		PedIgnoreStimuli(Ricky2)
		PedIgnoreStimuli(Peanut2)
		PedMoveToXYZ(Lefty3, 1, -625.37, -728.37, 0.82)
		PedMoveToXYZ(Norton2, 1, -625.37, -728.37, 0.82)
		PedMoveToXYZ(Ricky2, 1, -625.37, -728.37, 0.82)
		PedMoveToXYZ(Peanut2, 1, -625.37, -728.37, 0.82)
		Wait(500)
		SoundPlayScriptedSpeechEvent_2D("M_3_B_2D", 4, "supersize")
		repeat
		Wait(0)
		until PlayerIsInAreaXYZ(-623.25, -720.50, 0.88, 8, 0)
		PedDelete(Lefty3)
		PedDelete(Norton2)
		PedDelete(Ricky2)
		PedDelete(Peanut2)
		repeat
		Wait(0)
		until PlayerIsInAreaXYZ(-696.63, -655.76, 3.28, 7, 0)
		Ricky4 = PedCreateXYZ(28, -707.86, -619.64, 3.40)
		Wait(5)
		PedMoveToXYZ(Ricky4, 1, -718.24, -585.28, 2.78)
		PedIgnoreStimuli(Ricky4)
		repeat
		Wait(0)
		until PlayerIsInAreaXYZ(-754.68, -582.58, 4.58, 7, 0)
		PedDelete(Ricky4)
		repeat
		Wait(0)
		until PlayerIsInAreaXYZ(-764.92, -607.29, 5.20, 7, 0)
		Lefty4 = PedCreateXYZ(24, -765.98, -638.55, 6.27)
		Vance3 = PedCreateXYZ(27, -753.63, -660.80, 5.88)
		Wait(5)
		PedMoveToXYZ(Lefty4, 1, -756.95, -671.49, 5.89)
		PedMoveToXYZ(Vance3, 1, -746.53, -684.02, 5.50)
		PedIgnoreStimuli(Vance3)
		PedIgnoreStimuli(Lefty4)
		Wait(750)
		SoundPlayScriptedSpeechEvent(Vance3, "M_3_B", 2, "supersize")
		repeat
		Wait(0)
		until PlayerIsInAreaXYZ(-747.87, -689.61, 5.48, 10, 0)
		IntoCutscene = true
		MusicFadeWithCamera(false)
		CameraFade(500, 0)
		Wait(600)
		PedDelete(Lefty4)
		PedDelete(Vance3)
		if VehicleIsValid(CopCar) then
		VehicleStop(CopCar)
		VehicleDelete(CopCar)
		end
		if PedIsValid(CopCarDriver) then
		PedStop(CopCarDriver)
		PedDelete(CopCarDriver)
		end
		PedDelete(JohnnyChase)
		if PlayerIsInAnyVehicle() then
		PlayerDetachFromVehicle()
		end
		PlayCutsceneWithLoad("3-BB", true)
		WeaponRequestModel(396)
		PlayerSetPosXYZ(-736.567993, -624.682007, 3.460500)
		PlayerSetControl(0)
		CameraFade(750, 1)
		SoundPlayStream("MS_FightingJohnnyVincentFight.rsm", MUSIC_DEFAULT_VOLUME)
		LoadAnimationGroup("3_BFightJohnnyV")
		LoadAnimationGroup("P_Striker")
		LoadAnimationGroup("Boxing")
		VehicleDelete(JohnnyBike)
		VehicleDelete(JimmyBike)
		CameraSetXYZ(-745.90051269531, -625.61779785156, 4.3814768791199, -746.13647460938, -624.68780517578, 4.6622228622437)
		JohnnyBoss = PedCreatePoint(23, POINTLIST._3_B_JOHNNY_SPAWN)
		CreateThread("T_CreateEggers")
		TextPrintString("Find a way to turn off the crane.", 3, 1)
		SoundPlayScriptedSpeechEvent(JohnnyBoss, "M_3_B", 8, "supersize")
		Wait(3000)
		F_BossBattle()

end

F_BossBattle = function()

	DATLoad("3_B_BIKE_STUFF.DAT", 2)
	FollowCamDefaultVehicleShot()
	CameraReturnToPlayer()
	CreateThread("F2_JohnnySetUpBike")
	PlayerSetControl(1)
	PlayerSetWeapon(284, 1)
	local l_40_1 = CreateThread("T2_JohnnyAttacks")
	F2_JohnnyChoosePath()
	local l_40_0 = CreateThread("T2_JohnnyUpdates")
	SoundPlayScriptedSpeechEvent(JohnnyBoss, "M_3_B", 9, "supersize")
	Wait(5)
	PedAttack(Lefty, gPlayer, 3)
	PedAttack(Hal2, gPlayer, 3)
	PedAttack(Vance2, gPlayer, 3)
	PedAttack(Lucky4, gPlayer, 3)
	PedAttack(Ricky3, gPlayer, 3)
	PedAttack(Norton3, gPlayer, 3)
	Wait(3100)
	SoundPlayScriptedSpeechEvent(gPlayer, "M_3_B", 10, "supersize")
	Wait(5000)
	SoundPlayScriptedSpeechEvent(gPlayer, "M_3_B", 11, "supersize")
	CreateThread("T_CraneCutscene")
	repeat
	Wait(0)
	until CraneActive
	TerminateThread(T2_JohnnyUpdates)
	TerminateThread(T2_JohnnyAttacks)
	F_BossBattlePT2()
end

T_CreateEggers = function()

		EggersDead = false
		Lefty = PedCreatePoint(24, POINTLIST._3_B_STAGE2_THUG_A)
		Hal2 = PedCreatePoint(22, POINTLIST._3_B_STAGE2_THUG_B)
		Vance2 = PedCreatePoint(27, POINTLIST._3_B_STAGE2_THUG_C)
		Lucky4 = PedCreatePoint(26, POINTLIST._3_B_STAGE2_THUG_D)
		Ricky3 = PedCreatePoint(28, POINTLIST._3_B_STAGE2_THUG_E)
		Norton3 = PedCreatePoint(29, POINTLIST._3_B_STAGE2_THUG_F)
		Wait(10)
		PedSetActionTree(Lefty, "/Global/G_Ranged_A", "Act/Anim/G_Ranged_A.act")
		PedSetActionTree(Hal2, "/Global/G_Ranged_A", "Act/Anim/G_Ranged_A.act")
		PedSetActionTree(Vance2, "/Global/G_Ranged_A", "Act/Anim/G_Ranged_A.act")
		PedSetActionTree(Lucky4, "/Global/G_Ranged_A", "Act/Anim/G_Ranged_A.act")
		PedSetActionTree(Ricky3, "/Global/G_Ranged_A", "Act/Anim/G_Ranged_A.act")
		PedSetActionTree(Norton3, "/Global/G_Ranged_A", "Act/Anim/G_Ranged_A.act")
		PedFaceObjectNow(Lefty, gPlayer, 3)
		PedFaceObjectNow(Hal2, gPlayer, 3)
		PedFaceObjectNow(Vance2, gPlayer, 3)
		PedFaceObjectNow(Lucky4, gPlayer, 3)
		PedFaceObjectNow(Ricky3, gPlayer, 3)
		PedFaceObjectNow(Norton3, gPlayer, 3)
		PedSetStationary(Lefty, true)
		PedSetStationary(Hal2, true)
		PedSetStationary(Vance2, true)
		PedSetStationary(Lucky4, true)
		PedSetStationary(Ricky3, true)
		PedSetStationary(Norton3, true)
		PedSetHealth(Lefty, 50)
		PedSetHealth(Hal2, 50)
		PedSetHealth(Vance2, 50)
		PedSetHealth(Lucky4, 50)
		PedSetHealth(Ricky3, 50)
		PedSetHealth(Norton3, 50)
		PedOverrideStat(Lefty, 3, 100)
		PedOverrideStat(Lefty, 2, 100)
		PedOverrideStat(Lefty, 13, 0)
		PedOverrideStat(Lefty, 8, 10)
		PedOverrideStat(Lefty, 11, 90)
		PedOverrideStat(Lefty, 10, 10)
		PedOverrideStat(Lefty, 31, 10)
		PedSetWeapon(Lefty, 290, 20)
		PedSetWeapon(Ricky3, 290, 20)
		PedSetWeapon(Hal2, 287, 20)
		PedSetWeapon(Vance2, 290, 20)
		PedSetWeapon(Lucky4, 290, 20)
		PedSetWeapon(Norton3, 290, 20)
		PedLockTarget(Lefty, gPlayer)
		PedLockTarget(Hal2, gPlayer)
		PedLockTarget(Vance2, gPlayer)
		PedLockTarget(Lucky4, gPlayer)
		PedLockTarget(Ricky3, gPlayer)
		PedLockTarget(Norton3, gPlayer)
		repeat
		Wait(0)
		until PedIsDead(Lefty) and PedIsDead(Hal2) and PedIsDead(Vance2) and PedIsDead(Lucky4) and PedIsDead(Ricky3) and PedIsDead(Norton3)
		EggersDead = true

end

F2_JohnnySetUpBike = function()

  JohnnyBike = VehicleCreatePoint(258, POINTLIST._3_B_JOHNNY_BIKE_SPAWN)
  Wait(2)
  PedSetWeaponNow(JohnnyBoss, 396, 1)
  PedSetActionTree(JohnnyBoss, "/Global/G_Johnny", "Act/Anim/G_Johnny.act")
  PedSetHealth(JohnnyBoss, 500)
  PedShowHealthBar(JohnnyBoss, true, "N_JOHNNY", true)
  VehicleSetEntityFlag(JohnnyBike, 41, true)
  VehicleBikeForceBoundingSphereUpdate(JohnnyBike, true)
  PedPathNodeReachedDistance(JohnnyBoss, 2.5)
  PedOverrideStat(JohnnyBoss, 33, 100)
  PedOverrideStat(JohnnyBoss, 34, 0)
  PedOverrideStat(JohnnyBoss, 24, 50)
  PedSetFlag(JohnnyBoss, 107, true)
  PedSetDamageTakenMultiplier(JohnnyBoss, 3, 0.20000000298023)
  PedSetDamageTakenMultiplier(JohnnyBoss, 0, 0.30000001192093)
  PedIgnoreStimuli(JohnnyBoss, true)
  PedLockTarget(JohnnyBoss, gPlayer)
  Wait(125)
  PedPutOnBike(JohnnyBoss, JohnnyBike)

end

F_BossBattlePT2 = function()

		repeat
		Wait(0)
		until PedIsInAreaXYZ(JohnnyBoss, -745.55, -610.95, 3.27, 1.5, 0)
		PedStop(JohnnyBoss)
		PedSetAsleep(JohnnyBoss, true)
		PedSetActionNode(JohnnyBoss, "/Global/Vehicles/Bikes/ScriptCalls/3B_JohnnyVincent/Magnetized", "Act/Vehicles.act")
		SoundEmitterEnable("MagnetHum", false)
		Idk1, Idk2 = CreatePersistentEntity(418, -745.6669921875, -611.57397460938, 3.996789932251, 0, 43, 90)
		PAnimFollowPath(Idk1, Idk2, PATH._3_B_LEAD_PIPE_PATH, false)
		PAnimSetPathFollowSpeed(Idk1, Idk2, 3.5)
		DATUnload(2)
		PlayCutsceneWithLoad("3-BC", true)
		PlayerSetControl(0)
		Wait(500)
		SoundStopStream()
		SoundPlayStream("MS_FightingJohnnyVincentBossFight.rsm", 0.69999998807907, 500, 250)
		VehicleDelete(JohnnyBike)
		PedDelete(JohnnyBoss)
		JohnnyBoss2 = PedCreateXYZ(23, -745.55, -610.95, 3.27)
		Wait(10)
		PedSetActionTree(JohnnyBoss2, "/Global/G_Johnny", "Act/Anim/G_Johnny.act")
		Wait(100)
		PlayerUnequip()
		PedSetWeaponNow(JohnnyBoss2, 396, 1)
		PedSetHealth(JohnnyBoss2, 500)
		PedShowHealthBar(JohnnyBoss2, true, "N_JOHNNY", true)
		Wait(5)
		CameraFade(500, 1)
		Wait(250)
		PlayerSetControl(1)
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_B", 13, "supersize")
		PedAttackPlayer(JohnnyBoss2, 3, true)
		Wait(1800)
		SoundPlayScriptedSpeechEvent(JohnnyBoss2, "M_3_B", 14, "supersize")
		
		repeat
		Wait(0)
		until PedGetHealth(JohnnyBoss2) <= 250
		
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_B", 21, "supersize")
		
		repeat
		Wait(0)
		until PedIsDead(JohnnyBoss2)

		PlayerSetControl(0)
		PedSetInvulnerable(gPlayer, true)
		SoundPlayStreamNoLoop("MS_3-B_ENDTAG.rsm", 0.69999998807907, 0, 0)
		CameraFade(1000, 0)
		Wait(1001)
		--[[PedDelete(JohnnyBoss2)
		JohnnyFinalNIS = PedCreateXYZ(23, -742.67, -614.64, 3.01)
		PlayerSetPosXYZ(-740.93, -613.32, 3.02)
		Wait(5)
		PedFaceXYZ(gPlayer, -742.67, -614.64, 3.01)
		PedSetActionNode(JohnnyFinalNIS, "/Global/4_B2/ReactionAnims/GetUpEasy", "Act/Conv/4_B2.act")
		CameraSetXYZ(-742.75, -616.55, 3.49, -741.48, -612.76, 3.39)
		Wait(1)
		CameraFade(500, 1)
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_B", 23, "supersize")
		Wait(2600)
		CameraSetXYZ(-738.59, -612.93, 4.92, -741.99, -614.50, 3.53)
		SoundPlayScriptedSpeechEvent(JohnnyFinalNIS, "M_3_B", 24, "supersize")
		Wait(3000)
		CreateThread("StopMusic")
		CameraSetXYZ(-742.75, -616.55, 3.49, -741.48, -612.76, 3.39)
		SoundPlayScriptedSpeechEvent(gPlayer, "M_3_B", 25, "supersize")
		Wait(4100)
		CameraFade(500, 0)]]

end

StopMusic = function()

		while true do
		SoundStopStream()
		Wait(0)
		end

end

T_CraneCutscene = function()

		repeat
		Wait(0)
		until EggersDead
		
		Wait(1000)
		CameraFade(500, 0)
		Wait(350)
		PlayerSetControl(0)
		Wait(150)
		PedDelete(Lefty)
		PedDelete(Hal2)
		PedDelete(Vance2)
		PedDelete(Lucky4)
		PedDelete(Ricky3)
		PedDelete(Norton3)
		ToggleHUDComponentVisibility(12, false)
		PlayerSetPosXYZ(-739.03, -616.12, 3.10)
		Wait(5)
		PedFaceXYZ(gPlayer, -737.45, -612.58, 3.10)
		CameraSetXYZ(-733.92, -618.17, 6.02, -736.57, -615.24, 5.42)
		CameraFade(500, 1)
		PedMoveToXYZ(gPlayer, 1, -737.45, -612.58, 3.10)
		Wait(1500)
		PedFaceXYZ(gPlayer, -753.79699707031, -606.43902587891, 7.7574000358582)
		CameraSetXYZ(-738.35, -611.26, 3.90, -737.15, -614.96, 4.80)
		Wait(100)
		PedSetActionNode(gPlayer, "/Global/DodgeballGame/Anims/Unlock/Charge", "Act/Conv/DodgeballGame.act")
		Wait(1500)
		PedSetActionNode(gPlayer, "/Global/DodgeballGame/Anims/Unlock/Charge/Release/Release", "Act/Conv/DodgeballGame.act")
		Wait(1000)
		CameraSetXYZ(-750.78, -606.31, 7.82, -754.78, -606.46, 7.82)
		Wait(150)
		Button1, Button2 = CreatePersistentEntity("DPE_buttonOFF", -753.79699707031, -606.43902587891, 7.7574000358582, -113.70700073242, 43)
		Light1, Light2 = CreatePersistentEntity("JY1d_animlight", -749.92199707031, -608.28698730469, 8.5170202255249, 0, 43)
		Wait(200)
		SoundEmitterEnable("MagnetHum", true)
		Wait(1300)
		CameraReturnToPlayer()
		ToggleHUDComponentVisibility(12, true)
		PlayerSetControl(1)
		Wait(1000)
		CraneActive = true
end

T2_JohnnyUpdates = function()
  repeat
    if F_PedIsDead(JohnnyBoss) then
      F_MissionPass()
      return 
    end
    if not PedIsDead(JohnnyBoss) and DistanceBetweenPeds2D(gPlayer, JohnnyBoss) <= 2.2999999523163 and PedIsInVehicle(JohnnyBoss, JohnnyBike) and PedIsInAnyVehicle(JohnnyBoss) then
      PedSetActionNode(JohnnyBoss, "/Global/Vehicles/Bikes/ExecuteNodes/Attacks/LeadPipe/SwingLeftExec", "Act/Vehicles.act")
      Wait(200)
      PedSetActionNode(JohnnyBoss, "/Global/Vehicles/Bikes/ExecuteNodes/Attacks/LeadPipe/SwingRightExec", "Act/Vehicles.act")
      Wait(3000)
    end
    if not PedIsInAnyVehicle(JohnnyBoss) then
      PedStop(JohnnyBoss)
      PedClearObjectives(JohnnyBoss)
      repeat
        if not PedIsDead(JohnnyBoss) then
          PedEnterVehicle(JohnnyBoss, JohnnyBike)
        else
          EndingNIS()
          return 
        end
        Wait(0)
      until PedIsInAnyVehicle(JohnnyBoss)
    end
    Wait(0)
  until CraneActive
  collectgarbage()
end

F2_JohnnyChoosePath = function()
  local l_60_0, l_60_1, l_60_2 = PedGetPosXYZ(JohnnyBoss)
  if CraneActive then
    if PedIsInTrigger(JohnnyBoss, TRIGGER._3_B_REGION_S) then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_MAGNET_PATH_SW, 2, 4)
    else
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_MAGNET_PATH_NE, 2, 4)
    end
  elseif DistanceBetweenCoords2d(l_60_0, l_60_1, -740.76300048828, -615.85900878906) < 8 then
    if PedGetHeading(JohnnyBoss) < 0 and PedGetHeading(JohnnyBoss) >= -1.5707963705063 then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_NW, 1, 4)
    elseif PedGetHeading(JohnnyBoss) < -1.5707963705063 and PedGetHeading(JohnnyBoss) >= -3.1415927410126 then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_SW, 1, 4)
    elseif PedGetHeading(JohnnyBoss) < -3.1415927410126 and PedGetHeading(JohnnyBoss) >= -4.7123889923096 then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_SE, 1, 4)
    elseif PedGetHeading(JohnnyBoss) < -4.7123889923096 then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_NE, 1, 4)
    elseif PedGetHeading(JohnnyBoss) >= 0 and PedGetHeading(JohnnyBoss) < 1.5707963705063 then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_NE, 1, 4)
    elseif PedGetHeading(JohnnyBoss) >= 1.5707963705063 and PedGetHeading(JohnnyBoss) < 3.1415927410126 then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_SE, 1, 4)
    elseif PedGetHeading(JohnnyBoss) >= 3.1415927410126 and PedGetHeading(JohnnyBoss) < 4.7123889923096 then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_SW, 1, 4)
    elseif PedGetHeading(JohnnyBoss) >= 4.7123889923096 then
      PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_NW, 1, 4)
    end
  elseif PedIsInTrigger(JohnnyBoss, TRIGGER._3_B_BIKE_REGION_NE) then
    PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_NW, 1, 4)
  elseif PedIsInTrigger(JohnnyBoss, TRIGGER._3_B_BIKE_REGION_NW) then
    PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_SW, 1, 4)
  elseif PedIsInTrigger(JohnnyBoss, TRIGGER._3_B_BIKE_REGION_SW) then
    PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_SE, 1, 4)
  elseif PedIsInTrigger(JohnnyBoss, TRIGGER._3_B_BIKE_REGION_SE) then
    PedFollowPath(JohnnyBoss, PATH._3_B_JV_BIKE_PATH_NE, 1, 4)
  end
end

T2_JohnnyAttacks = function()
  repeat
    Z = 0
    Y = 0
    X = 0
    if PedIsInAnyVehicle(JohnnyBoss) then
      l_0_30 = true
      PedStop(JohnnyBoss)
      PedClearObjectives(JohnnyBoss)
      SoundPlayScriptedSpeechEvent(JohnnyBoss, "M_3_B", 18, "supersize")
      PedFaceObject(JohnnyBoss, gPlayer, 3, 0)
	X, Y, Z = PlayerGetPosXYZ()
      PedMoveToXYZ(JohnnyBoss, 1, X, Y, Z)
      repeat
      if not PedIsInAreaXYZ(JohnnyBoss, X, Y, Z, 3.5, 0) or not PedIsDead(JohnnyBoss) then
        PedStop(JohnnyBoss)
        PedSetActionNode(JohnnyBoss, "/Global/Vehicles/Bikes/ExecuteNodes/Attacks/LeadPipe/SwingRightExec", "Act/Vehicles.act")
        Wait(200)
        PedSetActionNode(JohnnyBoss, "/Global/Vehicles/Bikes/ExecuteNodes/Attacks/LeadPipe/SwingLeftExec", "Act/Vehicles.act")
        F2_JohnnyChoosePath()
        l_0_30 = false
        Wait(6000 + math.random(4000))
      else
        return 
      end
	  Wait(0)
	  until CraneActive
	  end
	  Wait(0)
	  until CraneActive
  collectgarbage()
end

MonitorJohnnySpeed = function()

	repeat
	dist = DistanceBetweenPeds2D(gPlayer, JohnnyChase)
    if VehicleIsValid(JohnnyBike) then
		if dist > 25 then
		PedFollowPath(JohnnyChase, PATH._3_B_JOHNNYBIKECHASEPLAYER, 0, 1)
		elseif dist < 8 then
		PedFollowPath(JohnnyChase, PATH._3_B_JOHNNYBIKECHASEPLAYER, 0, 2)
		end
	end
	Wait(0)
	until IntoCutscene
end

T1_CopChaseCarCam = function()
  repeat
  dist = DistanceBetweenPeds2D(gPlayer, CopCarDriver)
    if VehicleIsValid(CopCar) then
          if dist < 8 then
            VehicleSetCruiseSpeed(CopCar, 12)
          elseif dist < 8.5 then
            VehicleSetCruiseSpeed(CopCar, 17)
          elseif dist < 20 then
            VehicleSetCruiseSpeed(CopCar, 22)
          elseif dist < 25 then
            VehicleSetCruiseSpeed(CopCar, 25)
          end
		end
	Wait(0)
	until IntoCutscene
	VehicleStop(CopCar)
	VehicleDelete(CopCar)
	PedStop(CopCarDriver)
	PedDelete(CopCarDriver)
end